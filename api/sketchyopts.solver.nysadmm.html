
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NysADMM &#8212; SketchyOpts  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=9a799264" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=8953b41a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/sketchyopts.solver.nysadmm';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sGMRES" href="sketchyopts.solver.sgmres.html" />
    <link rel="prev" title="Nyström PCG" href="sketchyopts.solver.nystrom_pcg.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">SketchyOpts  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/support_vector_machine.html">Support Vector Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/ridge_regression.html">Ridge Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/l2_logistic_regression.html"><span class="math">\(\ell^2\)</span>-regularized Logistic Regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="sketchyopts.solver.html">Solvers</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sketchyopts.solver.nystrom_pcg.html">Nyström PCG</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">NysADMM</a></li>
<li class="toctree-l2"><a class="reference internal" href="sketchyopts.solver.sgmres.html">sGMRES</a></li>
<li class="toctree-l2"><a class="reference internal" href="sketchyopts.solver.promise.html">PROMISE</a></li>
<li class="toctree-l2"><a class="reference internal" href="sketchyopts.solver.base_solver.html">Base Iterative Solver</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.linear_solve.html">Linear Solve</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.nystrom.html">Nyström Approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.sketching.html">Sketching</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.base.html">Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.operator.html">Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.prox.html">Proximal Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.util.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketchyopts.error.html">Error Messages</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/udellgroup/sketchyopts" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/api/sketchyopts.solver.nysadmm.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>NysADMM</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMM"><code class="docutils literal notranslate"><span class="pre">NysADMM</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMM.run"><code class="docutils literal notranslate"><span class="pre">NysADMM.run()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMMState"><code class="docutils literal notranslate"><span class="pre">NysADMMState</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="nysadmm">
<h1>NysADMM<a class="headerlink" href="#nysadmm" title="Link to this heading">#</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="sketchyopts.solver.NysADMM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sketchyopts.solver.</span></span><span class="sig-name descname"><span class="pre">NysADMM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fun</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prox_reg_h</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_fun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hvp_fun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sketch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_seq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sketchyopts/solver/nysadmm.html#NysADMM"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sketchyopts.solver.NysADMM" title="Link to this definition">#</a></dt>
<dd><p>The NysADMM optimizer.</p>
<p>NysADMM is an inexact ADMM algorithm that uses randomized Nyström preconditioned
conjugate gradients to approximately solve one of the subproblems in each iteration.
The Nyström preconditioner is typically able to utilize the low-rank structure of
the problem and thus speed up the iterative optimization process.</p>
<p>The optimizer seeks to solve the following composite minimization problem</p>
<div class="math">
\[\underset{x}{\mathrm{minimize}} ~ \Big\{\mathrm{fun}(x) + \mathrm{reg\_g}(x) +
\mathrm{reg\_h}(x)\Big\}\]</div>
<p>We provide more detailed description of some arguments below.</p>
<p id="objective-fun"><code class="docutils literal notranslate"><span class="pre">fun</span></code> specifies the objective function of the optimization problem. The argument
is <strong>required</strong>. It must have:</p>
<ul class="simple">
<li><p>scalar output</p></li>
<li><p>optimization variable as <strong>first</strong> argument</p></li>
<li><p>argument <code class="docutils literal notranslate"><span class="pre">data</span></code> for data input</p></li>
</ul>
<p>For instance, <code class="docutils literal notranslate"><span class="pre">fun</span></code> could take the form <code class="code highlight python docutils literal highlight-python"><span class="n">value</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="o">**</span><span class="n">fun_params</span><span class="p">)</span></code>.</p>
<hr class="docutils" />
<p id="smooth-regularization"><code class="docutils literal notranslate"><span class="pre">reg_g</span></code> specifies the smooth component of the regularization of the problem. The
argument is <strong>required</strong>. It must have:</p>
<ul class="simple">
<li><p>scalar output</p></li>
<li><p>optimization variable as <strong>first</strong> argument</p></li>
</ul>
<p>For instance, <code class="docutils literal notranslate"><span class="pre">reg_g</span></code> could take the form <code class="code highlight python docutils literal highlight-python"><span class="n">value</span> <span class="o">=</span> <span class="n">reg_g</span><span class="p">(</span><span class="n">params</span><span class="p">,</span>
<span class="o">**</span><span class="n">reg_g_params</span><span class="p">)</span></code>.</p>
<hr class="docutils" />
<p id="prox-nonsmooth-regularization"><code class="docutils literal notranslate"><span class="pre">prox_reg_h</span></code> specifies the proximal operator of the non-smooth component of the
regularization of the problem. The argument is <strong>required</strong>. It must have:</p>
<ul class="simple">
<li><p>point to be mapped as <strong>first</strong> argument</p></li>
<li><p>keyword argument <code class="docutils literal notranslate"><span class="pre">scaling</span></code> that sets the scaling factor of the operator</p></li>
</ul>
<p>More precisely, <code class="docutils literal notranslate"><span class="pre">prox_reg_h</span></code> solves the following optimization problem</p>
<div class="math">
\[\mathrm{prox\_reg\_h}(x, \mathrm{scaling}) =
\underset{y}{\mathrm{argmin}} ~ \Big\{\mathrm{reg\_h}(x)
+ \frac{1}{2 \cdot \mathrm{scaling}} \lVert x - y \rVert_2^2\Big\}\]</div>
<p>For instance, <code class="docutils literal notranslate"><span class="pre">prox_reg_h</span></code> could take the form <code class="code highlight python docutils literal highlight-python"><span class="n">mapped_point</span> <span class="o">=</span>
<span class="n">prox_reg_g</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="o">**</span><span class="n">prox_reg_h_params</span><span class="p">)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SketchyOpts has some common proximal operators built in. These implementations can
be found in the <a class="reference internal" href="sketchyopts.prox.html"><span class="doc">Proximal Operators</span></a> module.</p>
</div>
<hr class="docutils" />
<p id="gradient-oracle"><code class="docutils literal notranslate"><span class="pre">grad_fun</span></code> specifies the gradient oracle that computes the gradient of the
objective function <code class="docutils literal notranslate"><span class="pre">fun</span></code> with respect to its first argument (<em>i.e.</em> the
optimization variable). The argument is <strong>optional</strong>.</p>
<ul class="simple">
<li><p>It is expected to have the same function signature as the objective function
<code class="docutils literal notranslate"><span class="pre">fun</span></code>. For instance, <code class="docutils literal notranslate"><span class="pre">grad_fun</span></code> could take the form
<code class="code highlight python docutils literal highlight-python"><span class="n">grad</span> <span class="o">=</span> <span class="n">grad_fun</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">fun_params</span><span class="p">)</span></code>.</p></li>
<li><p>The gradient output should have the same shape and type as the the optimization
variable.</p></li>
</ul>
<hr class="docutils" />
<p id="hvp-oracle"><code class="docutils literal notranslate"><span class="pre">hvp_fun</span></code> specifies the Hessian-vector product oracle that computes the
product of the Hessian and an arbitrary compatible vector. It is <strong>optional</strong>.
If provided, it must have:</p>
<ul class="simple">
<li><p>optimization variable as <strong>first</strong> argument</p></li>
<li><p>arbitrary vector (of the same shape and type as the optimization variable) as
<strong>second</strong> argument</p></li>
<li><p>same additional arguments as the objective function <code class="docutils literal notranslate"><span class="pre">fun</span></code> (<code class="docutils literal notranslate"><span class="pre">data</span></code>, etc.)</p></li>
<li><p>function output of the same shape and type as the optimization variable</p></li>
</ul>
<p>For instance, <code class="docutils literal notranslate"><span class="pre">hvp_fun</span></code> could take the form <code class="code highlight python docutils literal highlight-python"><span class="n">vec_output</span> <span class="o">=</span>
<span class="n">hvp_fun</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">fun_params</span><span class="p">)</span></code>.</p>
<hr class="docutils" />
<p id="tolerance-sequence"><code class="docutils literal notranslate"><span class="pre">tol_seq</span></code> specifies the tolerance sequence for the Nyström PCG subproblem. The
sequence should be positive summable. By default, the optimizer uses the geometric
mean of  the ADMM primal residual <span class="math">\(r_p\)</span> and dual residual <span class="math">\(r_d\)</span> at the
previous iteration</p>
<div class="math">
\[\varepsilon^{(k+1)} = \sqrt{r_p^{(k)} r_d^{(k)}}\]</div>
<p>Alternatively, use can provide a custom function that generate such sequence. The
function should take</p>
<ul class="simple">
<li><p><span class="math">\(x\)</span>: optimization variable</p></li>
<li><p><span class="math">\(z\)</span>: auxiliary variable</p></li>
<li><p><span class="math">\(u\)</span>: (scaled) dual variable</p></li>
<li><p><span class="math">\(r_p\)</span>: primal residual</p></li>
<li><p><span class="math">\(r_d\)</span>: dual residual</p></li>
<li><p><span class="math">\(b\)</span>: right-hand side of the Nyström PCG subproblem</p></li>
<li><p>iteration number</p></li>
</ul>
<p>as positional arguments and return a positive value.</p>
<hr class="docutils" />
<p id="stopping-criteria"><code class="docutils literal notranslate"><span class="pre">abs_tol</span></code> and <code class="docutils literal notranslate"><span class="pre">rel_tol</span></code> specify absolute and relative tolerances for terminating
the optimizer. Specifically, the optimization stops when</p>
<ul class="simple">
<li><p>the maximal number of iterations has been reached</p></li>
<li><p>or, the following stopping criteria have been met</p></li>
</ul>
<div class="math">
\[\begin{aligned}
    & \lVert r_p^{(k)} \rVert_2 \leqslant \mathrm{abs\_tol} + \mathrm{rel\_tol}
    \cdot \max \big\{\lVert x^{(k)} \rVert_2, \lVert z^{(k)} \rVert_2\big\} \\
    & \lVert r_d^{(k)} \rVert_2 \leqslant \mathrm{abs\_tol} + \mathrm{rel\_tol}
    \cdot \lVert \mathrm{step\_size} \, u^{(k)} \rVert_2 \\
\end{aligned}\]</div>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">sketchyopts.prox</span> <span class="kn">import</span> <span class="n">prox_l1</span>
<span class="kn">from</span> <span class="nn">sketchyopts.solver</span> <span class="kn">import</span> <span class="n">NysADMM</span>

<span class="k">def</span> <span class="nf">least_squares_objective</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># data has dimension num_samples * (feature_dim + 1)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,:</span><span class="n">feature_dim</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="n">feature_dim</span><span class="p">:]</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">reg</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">l2_squared_reg</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="n">reg_g_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scaling&#39;</span><span class="p">:</span> <span class="n">reg</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l1_ratio</span><span class="p">)}</span>
<span class="n">prox_reg_h_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;l1reg&#39;</span><span class="p">:</span> <span class="n">reg</span> <span class="o">*</span> <span class="n">l1_ratio</span><span class="p">}</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">NysADMM</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">least_squares_objective</span><span class="p">,</span>
              <span class="n">reg_g</span><span class="o">=</span><span class="n">l2_squared_reg</span><span class="p">,</span>
              <span class="n">prox_reg_h</span><span class="o">=</span><span class="n">prox_l1</span><span class="p">,</span>
              <span class="o">...</span><span class="p">)</span>
<span class="n">params</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init_params</span><span class="p">,</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="n">reg_g_params</span><span class="o">=</span><span class="n">reg_g_params</span><span class="p">,</span>
                        <span class="n">prox_reg_h_params</span><span class="o">=</span><span class="n">prox_reg_h_params</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">References</p>
<ul class="simple">
<li><p>S. Zhao, Z. Frangella, and M. Udell, <a class="reference external" href="https://proceedings.mlr.press/v162/zhao22a">NysADMM: faster composite convex
optimization via low-rank approximation</a>, Proceedings of the 39<sup>th</sup> International Conference on Machine
Learning, PMLR 162: 26824–26840, 2022.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fun</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a></span>) – Scalar-valued objective function. <a class="reference internal" href="#objective-fun"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>reg_g</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a></span>) – Smooth component of regularization function. <a class="reference internal" href="#smooth-regularization"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>prox_reg_h</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a></span>) – Proximal operator of the non-smooth component of regularization function. <a class="reference internal" href="#prox-nonsmooth-regularization"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>grad_fun</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>]</span>) – Optional gradient oracle corresponding to the provided objective
function <code class="docutils literal notranslate"><span class="pre">fun</span></code>. <a class="reference internal" href="#gradient-oracle"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>hvp_fun</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>]</span>) – Optional Hessian-vector product oracle corresponding to the provided
objective function <code class="docutils literal notranslate"><span class="pre">fun</span></code>. <a class="reference internal" href="#hvp-oracle"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>step_size</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Step size of the optimizer. Expect a non-negative value.</p></li>
<li><p><strong>sketch_size</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – Rank of the Nyström preconditioner. Expect a positive value (default
<code class="docutils literal notranslate"><span class="pre">10</span></code>).</p></li>
<li><p><strong>update_freq</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – Update frequency of the preconditioner for the subproblem solver.
When set to <code class="docutils literal notranslate"><span class="pre">0</span></code> or <span class="math">\(\infty\)</span> (e.g. jax.numpy.inf or numpy.inf), the the
optimizer uses constant preconditioner that is constructed at the beginning of
the optimization process.</p></li>
<li><p><strong>tol_seq</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>]</span>) – Optional tolerance function for the subproblem. If not provided, the
optimizer uses the geometric mean of the primal and dual residuals at the
previous iteration (default <code class="docutils literal notranslate"><span class="pre">None</span></code>). <a class="reference internal" href="#tolerance-sequence"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>seed</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – Initial seed for the random number generator (default <code class="docutils literal notranslate"><span class="pre">0</span></code>).</p></li>
<li><p><strong>maxiter</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – Maximum number of iterations to run the optimizer (default <code class="docutils literal notranslate"><span class="pre">20</span></code>).
Expect a positive value.</p></li>
<li><p><strong>abs_tol</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Absolute criterion for terminating the optimizer (default <code class="docutils literal notranslate"><span class="pre">1e-4</span></code>). <a class="reference internal" href="#stopping-criteria"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>rel_tol</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Relative criterion for terminating the optimizer (default <code class="docutils literal notranslate"><span class="pre">1e-4</span></code>). <a class="reference internal" href="#stopping-criteria"><span class="std std-ref">↪ More Details</span></a></p></li>
<li><p><strong>verbose</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to print diagnostic message (default <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p></li>
<li><p><strong>jit</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></span>) – Whether to JIT-compile the optimization process (default <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="sketchyopts.solver.NysADMM.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">init_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fun_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_g_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prox_reg_h_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sketchyopts/solver/nysadmm.html#NysADMM.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sketchyopts.solver.NysADMM.run" title="Link to this definition">#</a></dt>
<dd><p>The function runs the optimization loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>init_params</strong> – Initial value of the optimization variable.</p></li>
<li><p><strong>data</strong> – Full dataset. Expect an array of shape <code class="docutils literal notranslate"><span class="pre">(num_samples,</span> <span class="pre">...)</span></code>.</p></li>
<li><p><strong>fun_params</strong> – Additional keyword arguments to be passed to <code class="docutils literal notranslate"><span class="pre">fun</span></code> (and
<code class="docutils literal notranslate"><span class="pre">grad_fun</span></code>, <code class="docutils literal notranslate"><span class="pre">hvp_fun</span></code> if provided).</p></li>
<li><p><strong>reg_g_params</strong> – Additional keyword arguments to be passed to <code class="docutils literal notranslate"><span class="pre">reg_g</span></code>.</p></li>
<li><p><strong>prox_reg_h_params</strong> – Additional keyword arguments to be passed to <code class="docutils literal notranslate"><span class="pre">prox_reg_h</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="sketchyopts.base.html#sketchyopts.base.SolverState" title="sketchyopts.base.SolverState"><code class="xref py py-class docutils literal notranslate"><span class="pre">SolverState</span></code></a></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Final optimization variable and solver state. The variable has the same shape
as the provided initial value <code class="docutils literal notranslate"><span class="pre">init_params</span></code>, and the state is an
<a class="reference internal" href="#sketchyopts.solver.NysADMM" title="sketchyopts.solver.NysADMM"><code class="xref py py-class docutils literal notranslate"><span class="pre">NysADMM</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sketchyopts.solver.NysADMMState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">sketchyopts.solver.</span></span><span class="sig-name descname"><span class="pre">NysADMMState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iter_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.Array.html#jax.Array" title="(in JAX)"><span class="pre">Array</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">res_primal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.Array.html#jax.Array" title="(in JAX)"><span class="pre">Array</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">res_dual</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://jax.readthedocs.io/en/latest/_autosummary/jax.Array.html#jax.Array" title="(in JAX)"><span class="pre">Array</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sketchyopts/solver/nysadmm.html#NysADMMState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#sketchyopts.solver.NysADMMState" title="Link to this definition">#</a></dt>
<dd><p>The NysADMM optimizer state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>iter_num</strong> – Number of iterations the optimizer has performed.</p></li>
<li><p><strong>res_primal</strong> – Primal residual at the current iterate.</p></li>
<li><p><strong>res_dual</strong> – Dual residual at the current iterate.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sketchyopts.solver.nystrom_pcg.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Nyström PCG</p>
      </div>
    </a>
    <a class="right-next"
       href="sketchyopts.solver.sgmres.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">sGMRES</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMM"><code class="docutils literal notranslate"><span class="pre">NysADMM</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMM.run"><code class="docutils literal notranslate"><span class="pre">NysADMM.run()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketchyopts.solver.NysADMMState"><code class="docutils literal notranslate"><span class="pre">NysADMMState</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>